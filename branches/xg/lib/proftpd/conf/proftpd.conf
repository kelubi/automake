#Basic setting
ServerName    "FTP Server"
ServerType    standalone
ServerAdmin    root@localhost
DefaultServer   On
ServerIdent    Off
DisplayLogin   /usr/local/proftpd/etc/ftplogin.msg
Port     21
Umask     022
MaxLoginAttempts  5
TimeoutStalled   600
TimeoutLogin   900
TimeoutIdle    600
TimeoutNoTransfer  600
User     ftpd
Group     ftpd
DefaultRoot    ~
RequireValidShell  off
UseReverseDNS   off
IdentLookups   off
AllowStoreRestart  on
AllowRetrieveRestart on
MaxInstances   30
#Access control
<Limit LOGIN>
    AllowAll
</Limit>
<Directory />
    AllowOverwrite on
</Directory>
#MySQL connection setting
SQLConnectInfo  proftpd@127.0.0.1  proftpd PROFTPD_PASSWORD
SQLAuthTypes   Plaintext
SQLUserInfo    ftpusers userid passwd uid gid homedir shell
SQLGroupInfo   ftpgroups groupname gid members
SQLAuthenticate   users groups
SQLNegativeCache  on
#SQLHomedirOnDemand  on
SQLDefaultGID   PROFTPD_GID
SQLDefaultUID   PROFTPD_UID
SQLNamedQuery getcount SELECT "count from ftpusers where userid='%u'"
SQLNamedQuery getlastlogin SELECT "lastlogin from ftpusers where userid='%u'"
SQLNamedQuery updatelogininfo UPDATE "count=count+1,host='%h',lastlogin=current_timestamp() WHERE userid='%u'" ftpusers
SQLShowInfo PASS "230" "You've logged on %{getcount} times,last login at %{getlastlogin}"
SQLLog PASS updatelogininfo
#Disk quota seeting
QuotaDirectoryTally  on
QuotaDisplayUnits  "Mb"
QuotaEngine    on
QuotaShowQuotas   on
SQLNamedQuery get-quota-limit SELECT "name,quota_type,per_session,limit_type,bytes_in_avail,bytes_out_avail,bytes_xfer_avail,files_in_avail,files_out_avail,files_xfer_avail FROM quotalimits WHERE name = '%{0}' AND quota_type='%{1}'"
SQLNamedQuery get-quota-tally SELECT "name,quota_type,bytes_in_used,bytes_out_used,bytes_xfer_used,files_in_used,files_out_used,files_xfer_used FROM quotatallies WHERE name = '%{0}' AND quota_type = '%{1}'"
SQLNamedQuery update-quota-tally UPDATE "bytes_in_used = bytes_in_used + %{0},bytes_out_used = bytes_out_used + %{1},bytes_xfer_used = bytes_xfer_used + %{2},files_in_used = files_in_used + %{3},files_out_used = files_out_used + %{4},files_xfer_used = files_xfer_used + %{5} WHERE name = '%{6}' AND quota_type = '%{7}'" quotatallies
SQLNamedQuery insert-quota-tally INSERT "%{0},%{1},%{2},%{3},%{4},%{5},%{6},%{7}" quotatallies
#QuotaLimitTable sql:/get-quota-limit
#QuotaTallyTable sql:/get-quota-tally/update-quota-tally/insert-quota-tally